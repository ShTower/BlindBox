<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•ç®¡ç†å‘˜åŠŸèƒ½</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-card h3 {
            color: #333;
            margin-top: 0;
        }
        .btn {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin-top: 10px;
            white-space: pre-wrap;
        }
        .success {
            background-color: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <h1>ğŸ ç›²ç›’ç®¡ç†åå°åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-card">
        <h3>ğŸ“Š APIè¿æ¥æµ‹è¯•</h3>
        <p>æµ‹è¯•åç«¯APIæ˜¯å¦æ­£å¸¸è¿è¡Œ</p>
        <button class="btn" onclick="testApiConnection()">æµ‹è¯•APIè¿æ¥</button>
        <div id="apiResult" class="result"></div>
    </div>

    <div class="test-card">
        <h3>ğŸ“¦ è·å–å•†å“åˆ—è¡¨</h3>
        <p>æµ‹è¯•è·å–æ‰€æœ‰å•†å“æ•°æ®</p>
        <button class="btn" onclick="testGetProducts()">è·å–å•†å“åˆ—è¡¨</button>
        <div id="productsResult" class="result"></div>
    </div>

    <div class="test-card">
        <h3>â• æ·»åŠ æµ‹è¯•å•†å“</h3>
        <p>æµ‹è¯•æ·»åŠ æ–°å•†å“åŠŸèƒ½</p>
        <button class="btn" onclick="testAddProduct()">æ·»åŠ æµ‹è¯•å•†å“</button>
        <div id="addResult" class="result"></div>
    </div>

    <div class="test-card">
        <h3>ğŸ”„ æ›´æ–°å•†å“ä¿¡æ¯</h3>
        <p>æµ‹è¯•æ›´æ–°å•†å“åŠŸèƒ½ï¼ˆéœ€è¦å…ˆæ·»åŠ å•†å“ï¼‰</p>
        <button class="btn" onclick="testUpdateProduct()">æ›´æ–°å•†å“</button>
        <div id="updateResult" class="result"></div>
    </div>

    <div class="test-card">
        <h3>ğŸ—‘ï¸ åˆ é™¤å•†å“</h3>
        <p>æµ‹è¯•åˆ é™¤å•†å“åŠŸèƒ½ï¼ˆéœ€è¦å…ˆæ·»åŠ å•†å“ï¼‰</p>
        <button class="btn" onclick="testDeleteProduct()">åˆ é™¤å•†å“</button>
        <div id="deleteResult" class="result"></div>
    </div>

    <div class="test-card">
        <h3>ğŸ”— ç®¡ç†å‘˜é¡µé¢é“¾æ¥</h3>
        <p>ç‚¹å‡»ä¸‹æ–¹é“¾æ¥è®¿é—®ç®¡ç†å‘˜ç•Œé¢</p>
        <a href="http://localhost:3000/admin" target="_blank" class="btn">æ‰“å¼€ç®¡ç†å‘˜é¡µé¢</a>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';
        let lastProductId = null;

        function displayResult(elementId, result, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.textContent = JSON.stringify(result, null, 2);
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
        }

        async function testApiConnection() {
            try {
                const response = await fetch(`${API_BASE}/products`);
                const data = await response.json();
                displayResult('apiResult', {
                    status: response.ok ? 'SUCCESS' : 'FAILED',
                    statusCode: response.status,
                    message: response.ok ? 'åç«¯APIè¿æ¥æ­£å¸¸' : 'åç«¯APIè¿æ¥å¤±è´¥',
                    data: response.ok ? `æ‰¾åˆ° ${data.products?.length || 0} ä¸ªå•†å“` : data
                });
            } catch (error) {
                displayResult('apiResult', {
                    status: 'ERROR',
                    message: 'æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨',
                    error: error.message
                }, false);
            }
        }

        async function testGetProducts() {
            try {
                const response = await fetch(`${API_BASE}/products`);
                const data = await response.json();
                displayResult('productsResult', {
                    status: response.ok ? 'SUCCESS' : 'FAILED',
                    productCount: data.products?.length || 0,
                    products: data.products?.slice(0, 3) || [] // åªæ˜¾ç¤ºå‰3ä¸ªå•†å“
                });
            } catch (error) {
                displayResult('productsResult', {
                    status: 'ERROR',
                    error: error.message
                }, false);
            }
        }

        async function testAddProduct() {
            try {
                const testProduct = {
                    name: 'æµ‹è¯•ç›²ç›’ ' + Date.now(),
                    description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å•†å“ï¼Œç”¨äºéªŒè¯ç®¡ç†å‘˜åŠŸèƒ½',
                    price: 99.99,
                    stock: 10,
                    image_url: 'https://via.placeholder.com/300x300?text=Test+Product'
                };

                const response = await fetch(`${API_BASE}/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testProduct)
                });
                
                const data = await response.json();
                if (response.ok) {
                    lastProductId = data.product.id;
                }
                
                displayResult('addResult', {
                    status: response.ok ? 'SUCCESS' : 'FAILED',
                    productId: data.product?.id,
                    message: data.message || data.error,
                    product: data.product
                });
            } catch (error) {
                displayResult('addResult', {
                    status: 'ERROR',
                    error: error.message
                }, false);
            }
        }

        async function testUpdateProduct() {
            if (!lastProductId) {
                displayResult('updateResult', {
                    status: 'ERROR',
                    message: 'è¯·å…ˆæ·»åŠ æµ‹è¯•å•†å“'
                }, false);
                return;
            }

            try {
                const updateData = {
                    name: 'æ›´æ–°åçš„æµ‹è¯•ç›²ç›’',
                    description: 'è¿™ä¸ªå•†å“å·²ç»è¢«æ›´æ–°',
                    price: 129.99,
                    stock: 5,
                    image_url: 'https://via.placeholder.com/300x300?text=Updated+Product'
                };

                const response = await fetch(`${API_BASE}/products/${lastProductId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateData)
                });
                
                const data = await response.json();
                displayResult('updateResult', {
                    status: response.ok ? 'SUCCESS' : 'FAILED',
                    productId: lastProductId,
                    message: data.message || data.error,
                    product: data.product
                });
            } catch (error) {
                displayResult('updateResult', {
                    status: 'ERROR',
                    error: error.message
                }, false);
            }
        }

        async function testDeleteProduct() {
            if (!lastProductId) {
                displayResult('deleteResult', {
                    status: 'ERROR',
                    message: 'è¯·å…ˆæ·»åŠ æµ‹è¯•å•†å“'
                }, false);
                return;
            }

            try {
                const response = await fetch(`${API_BASE}/products/${lastProductId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                displayResult('deleteResult', {
                    status: response.ok ? 'SUCCESS' : 'FAILED',
                    productId: lastProductId,
                    message: data.message || data.error
                });
                
                if (response.ok) {
                    lastProductId = null;
                }
            } catch (error) {
                displayResult('deleteResult', {
                    status: 'ERROR',
                    error: error.message
                }, false);
            }
        }
    </script>
</body>
</html>
